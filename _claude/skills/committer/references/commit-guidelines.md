# コミットメッセージガイドライン

## 目次

1. [基本原則](#基本原則)
2. [メッセージ構造](#メッセージ構造)
3. [変更種別の判断](#変更種別の判断)
4. [アンチパターン](#アンチパターン)
5. [特殊なケース](#特殊なケース)

---

## 基本原則

### 1. 「なぜ」を伝える

コードを見れば「何を」変更したかは分かる。コミットメッセージでは「なぜ」その変更が必要だったかを伝える。

**良い例**:
```
ログイン試行回数の上限を5回から10回に変更

カスタマーサポートへの問い合わせが増加していたため。
パスワードマネージャー利用者の誤入力が主な原因と判明。
```

**悪い例**:
```
MAX_LOGIN_ATTEMPTS を 5 から 10 に変更
```

### 2. 単一責任

1つのコミットには1つの論理的な変更のみ含める。

**分離すべき例**:
- バグ修正とリファクタリング
- 機能追加とコードフォーマット
- 複数の独立した機能修正

### 3. 原子性

コミットは独立して意味を持ち、ビルドが通る状態を維持する。

---

## メッセージ構造

### 基本形式

```
<要約行>（必須）

<詳細説明>（任意）

<関連情報>（任意）
```

### 要約行のルール

- 50文字以内を目安（日本語の場合は25文字程度）
- 文末にピリオド/句点を付けない
- 命令形または体言止め

**例**:
```
認証エラー時のリトライ処理を追加
セッション管理のメモリリークを修正
ユーザー一覧の取得APIを実装
```

### 詳細説明のルール

- 要約行と1行空けて記述
- 72文字以内で折り返し
- 変更の動機、背景、影響を説明
- 箇条書きも可

**例**:
```
認証エラー時のリトライ処理を追加

外部認証サービスの一時的なエラーでログインが
失敗するケースが報告されていた。

- 最大3回までリトライ
- 指数バックオフで間隔を調整
- タイムアウトは合計30秒以内
```

---

## 変更種別の判断

| 変更内容 | 判断基準 |
|----------|----------|
| **新機能** | 新しいユーザー向け機能の追加 |
| **バグ修正** | 期待どおり動作しない問題の修正 |
| **リファクタリング** | 動作を変えずに構造を改善 |
| **パフォーマンス** | 速度やリソース使用量の改善 |
| **テスト** | テストコードの追加・修正 |
| **ドキュメント** | README、コメント、ドキュメントの変更 |
| **スタイル** | フォーマット、空白、セミコロンなど |
| **ビルド** | ビルドシステム、CI/CD の変更 |
| **依存関係** | 外部ライブラリの追加・更新・削除 |

---

## アンチパターン

### 避けるべきメッセージ

| パターン | 問題点 |
|----------|--------|
| `fix bug` | 何を修正したか不明 |
| `update` | 何を更新したか不明 |
| `WIP` | 作業途中はコミットしない |
| `misc changes` | 変更内容が曖昧 |
| `typo` | 複数の typo 修正を1コミットにまとめて詳細を書く |
| `review comment` | 具体的に何を修正したか書く |

### 避けるべき行動

- **バッチコミット**: 1日の終わりに全変更をまとめてコミット
- **巨大コミット**: 100ファイル以上の変更を1コミットに
- **混合コミット**: 機能追加とバグ修正を同一コミットに

---

## 特殊なケース

### マージコミット

自動生成されたメッセージをそのまま使用してよい。

### リバートコミット

```
Revert "元のコミットメッセージ"

理由: 本番環境でパフォーマンス低下が発生したため
```

### 修正コミット（--amend 使用時）

元のメッセージを維持しつつ、必要に応じて詳細を追加:

```
認証エラー時のリトライ処理を追加

外部認証サービスの一時的なエラーでログインが
失敗するケースが報告されていた。

- 最大3回までリトライ
- 指数バックオフで間隔を調整
- リトライ中のログ出力を追加（レビュー指摘対応）
```

### 複数ファイルの関連変更

関連する変更は1コミットにまとめる:

```
ユーザー削除APIの実装

- DELETE /api/users/:id エンドポイント追加
- 関連するセッションの無効化処理
- 削除確認のテストケース追加
```

---

## 言語選択の指針

### 日本語を使う場合

- リポジトリの過去のコミットが日本語主体
- チームメンバーが日本語話者のみ
- 社内プロジェクト

### 英語を使う場合

- OSS プロジェクト
- 国際チーム
- 過去のコミットが英語主体

### 迷った場合

直近10件のコミットを確認し、多数派に合わせる:

```bash
git log --oneline -10
```
